\documentclass{article}
\usepackage[a4paper, left=25.4mm, top=25.4mm, right=25.4mm, bottom=25.4mm]{geometry}
\usepackage[shortlabels]{enumitem}
\usepackage[T1]{fontenc}
\usepackage{adjustbox}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{authoraftertitle}
\usepackage{blindtext}
\usepackage{booktabs}
\usepackage{bussproofs}
\usepackage{cancel}
\usepackage{color}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{latexsym}
\usepackage{listings}
\usepackage{multicol}
\usepackage{subcaption}
\usepackage{textcomp}
\usepackage{textgreek}
\usepackage{vwcol}
\newcommand\tab[1]{\hspace*{#1}}
\newcommand\lowermidtilde{\raisebox{-0.8ex}{\textasciitilde}}
\newcommand\midtilde{\raisebox{-0.6ex}{\textasciitilde}}
\newcommand{\partfarrow}{\rightharpoonup}
\newcommand{\partf}{\rightharpoonup\!\!\!\!\!\!\!\!\!\raisebox{2.5pt}{$\rightharpoonup$}}
\renewcommand{\thesubsection}{\arabic{subsection}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\ttdefault}{pcr}
\renewcommand\qedsymbol{Q.E.D.}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\lstset{
    basicstyle=\ttfamily,
    commentstyle=\color{gray}\ttfamily,
    keywordstyle=\ttfamily\bfseries,
    columns=flexible,
    numbers=left,
    numberstyle=\tiny,
    firstnumber=0,
    showstringspaces=false,
}
\setlist{  
    listparindent=\parindent,
    align=parleft,
}

\author{Victor Zhao\\xz398@cam.ac.uk}

\begin{document}
\centering
\section*{Types\\CST Part IB Paper 8 \& 9}
\MyAuthor

\justifying

\subsection{Simply-Typed $\lambda$-Calculus}

\subsection*{Syntax}

\hspace{-1em}
\begin{tabular}{lccl}
Types   & $T$ & $::=$ & $1\ |\ 0\ |\ T_1\times T_2\ |\ T_1+T_2\ |\ T_1\to T_2$\\[0.5em]
Terms   & $e$ & $::=$ & $x\ |\ \langle\rangle\ |\ \langle e_1,e_2\rangle\ |\ \textsf{fst }e\ |\ \textsf{snd }e\ |\ \textsf{L }e\ |\ \textsf{R }e\ |\ \textsf{case}(e,\textsf{L }x\to e_1,\textsf{R }y\to e_2)$\\ 
        & {}  & $|$   & $\lambda x:T.\ e\ |\ e_1\ e_2\ |\ \textsf{abort}$\\[0.5em]
Values  & $v$ & $::=$ & $\langle\rangle\ |\ \langle v_1,v_2\rangle\ |\ \lambda x:T.\ e\ |\ \textsf{L }v\ |\ \textsf{R }v$\\[0.5em] 
Contexts & $\Gamma$ & $::=$ & $\cdot\ |\ \Gamma,x:T$
\end{tabular} 

\subsection*{Typing rules}

(\textsc{I}: introduction rule, \textsc{E}: elimination rule, \textsc{Hyp}: hypothesis)
\medbreak
\noindent
\AxiomC{{\color{white} $\langle\rangle$}} % placeholder
\RightLabel{\textsc{1I}}
\UnaryInfC{$\Gamma\vdash\langle\rangle:1$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma\vdash e_1:T_1$}
\AxiomC{$\Gamma\vdash e_2:T_2$}
\RightLabel{\textsc{$\times$I}}
\BinaryInfC{$\Gamma\vdash\langle e_1, e_2\rangle:1$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma\vdash e:T_1\times T_2$} 
\RightLabel{\textsc{$\times$E$_1$}}
\UnaryInfC{$\Gamma\vdash\textsf{fst }e:T_1$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma\vdash e:T_1\times T_2$} 
\RightLabel{\textsc{$\times$E$_2$}}
\UnaryInfC{$\Gamma\vdash\textsf{snd }e:T_2$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$x:T\in\Gamma$} 
\RightLabel{\textsc{Hyp}}
\UnaryInfC{$\Gamma\vdash x:T$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma,x:T\vdash e:T'$} 
\RightLabel{\textsc{$\to$I}}
\UnaryInfC{$\Gamma\vdash\lambda x:T.\ e:T\to T'$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma\vdash e_1:T\to T'$}
\AxiomC{$\Gamma\vdash e_2:T$}
\RightLabel{\textsc{$\to$E}}
\BinaryInfC{$\Gamma\vdash e_1\ e_2:T'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Gamma\vdash e:T_1$} 
\RightLabel{\textsc{$+$I$_1$}}
\UnaryInfC{$\Gamma\vdash\textsf{L }e:T_1+T_2$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Gamma\vdash e:T_2$} 
\RightLabel{\textsc{$+$I$_2$}}
\UnaryInfC{$\Gamma\vdash\textsf{R }e:T_1+T_2$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Gamma\vdash e:T_1+T_2$}
\AxiomC{$\Gamma,x:X\vdash e_1:T$}
\AxiomC{$\Gamma,x:X\vdash e_2:T$}
\RightLabel{\textsc{$+$E}}
\TrinaryInfC{$\Gamma\vdash\textsf{case}(e,\textsf{L }x\to e_1,\textsf{R }y\to e_2):T$}
\DisplayProof\bigbreak %========================================================
\noindent
(No introduction for 0)$\qquad$
\AxiomC{$\Gamma\vdash e:0$} 
\RightLabel{\textsc{0E}}
\UnaryInfC{$\Gamma\vdash\textsf{abort }e:T$}
\DisplayProof

\subsection*{Operational semantics}

(No rule for unit)$\qquad$
\AxiomC{$e_1\leadsto e_1'$}
\RightLabel{\textsc{Pair1}}
\UnaryInfC{$\langle e_1,e_2\rangle\leadsto\langle e_1',e_2\rangle$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$e_2\leadsto e_2'$}
\RightLabel{\textsc{Pair2}}
\UnaryInfC{$\langle v,e_2\rangle\leadsto\langle v,e_2'\rangle$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{{\color{white} $\langle\rangle$}} % placeholder
\RightLabel{\textsc{Proj1}}
\UnaryInfC{$\textsf{fst }\langle v_1,v_2\rangle\leadsto v_1$}
\DisplayProof$\quad$ %==========================================================
\AxiomC{{\color{white} $\langle\rangle$}} % placeholder
\RightLabel{\textsc{Proj2}}
\UnaryInfC{$\textsf{snd }\langle v_1,v_2\rangle\leadsto v_2$}
\DisplayProof$\quad$ %==========================================================
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Proj3}}
\UnaryInfC{$\textsf{fst }e\leadsto\textsf{fst }e'$}
\DisplayProof$\quad$ %==========================================================
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Proj4}}
\UnaryInfC{$\textsf{snd }e\leadsto\textsf{snd }e'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Sum1}}
\UnaryInfC{$\textsf{L }e\leadsto\textsf{L }e'$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Sum2}}
\UnaryInfC{$\textsf{R }e\leadsto\textsf{R }e'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Case1}}
\UnaryInfC{$\textsf{case}(e,\textsf{L }x\to e_1,\textsf{R }y\to e_2)\leadsto\textsf{case}(e',\textsf{L }x\to e_1,\textsf{R }y\to e_2)$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{Case2}}
\UnaryInfC{$\textsf{case}(\textsf{L }v,\textsf{L }x\to e_1,\textsf{R }y\to e_2)\leadsto[v/x]e_1$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{Case3}}
\UnaryInfC{$\textsf{case}(\textsf{R }v,\textsf{L }x\to e_1,\textsf{R }y\to e_2)\leadsto[v/y]e_2$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e_1\leadsto e_1'$}
\RightLabel{\textsc{App1}}
\UnaryInfC{$e_1\ e_2\leadsto e_1'\ e_2$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$e_2\leadsto e_2'$}
\RightLabel{\textsc{App2}}
\UnaryInfC{$v\ e_2\leadsto v\ e_2'$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{Fn}}
\UnaryInfC{$(\lambda x:T.\ e)\ v\leadsto[v/x]e$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e\leadsto e'$} 
\RightLabel{\textsc{Abort}}
\UnaryInfC{$\textsf{abort }e\leadsto\textsf{abort }e'$}
\DisplayProof\newpage %=========================================================

\subsection{Polymorphic $\lambda$-Calculus (System F)}

\subsection*{Syntax}

\hspace{-1em}
\begin{tabular}{lccl}
Types   & $T$ & $::=$ & $\tau\ |\ T_1\to T_2\ |\ \forall\tau.\ T\ |\ \exists\tau.\ T$\\[0.5em]
Terms   & $e$ & $::=$ & $x\ |\ \lambda x:T.\ e\ |\ e_1\ e_2\ |\ \Lambda\tau.\ e\ |\ e\ T\ |\ \textsf{pack}_{\tau.T'}(T,e)\ |\ \textsf{let pack}(\tau,x)=e\textsf{ in }e'$\\[0.5em]
Values  & $v$ & $::=$ & $\lambda x:T.\ e\ |\ \Lambda\tau.\ e\ |\ \textsf{pack}_{\tau.T'}(T,v)$\\[0.5em] 
Type Contexts & $\Theta$ & $::=$ & $\cdot\ |\ \Theta,\tau$\\[0.5em] 
Term Contexts & $\Gamma$ & $::=$ & $\cdot\ |\ \Gamma,x:T$
\end{tabular} 

\subsection*{Well-formedness of types}

\vspace{0.5em}
\AxiomC{$\tau\in\Theta$} 
\UnaryInfC{$\Theta\vdash\tau\text{ type}$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Theta\vdash T_1\text{ type}$} 
\AxiomC{$\Theta\vdash T_2\text{ type}$} 
\BinaryInfC{$\Theta\vdash T_1\to T_2\text{ type}$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Theta,\tau\vdash T\text{ type}$} 
\UnaryInfC{$\Theta\vdash\forall\tau.\ T\text{ type}$}
\DisplayProof

\subsection*{Well-formedness of term contexts}

\vspace{0.5em}
\AxiomC{{\color{white} $\Theta\vdash\Gamma$}} %placeholder 
\UnaryInfC{$\Theta\vdash\cdot\text{ ctx}$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Theta\vdash\Gamma\text{ ctx}$} 
\AxiomC{$\Theta\vdash T\text{ type}$} 
\BinaryInfC{$\Theta\vdash\Gamma,x:T\text{ ctx}$}
\DisplayProof

\subsection*{Typing rules}

\vspace{0.5em}
\AxiomC{$x:T\in\Gamma$} 
\RightLabel{\textsc{Hyp}}
\UnaryInfC{$\Theta;\Gamma\vdash x:T$}
\DisplayProof$\qquad$ %==========================================================
\AxiomC{$\Theta\vdash T\text{ type}$} 
\AxiomC{$\Theta;\Gamma,x:T\vdash e:T'$} 
\RightLabel{\textsc{$\to$I}}
\BinaryInfC{$\Theta;\Gamma\vdash\lambda x:T.\ e:T\to T'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Theta;\Gamma\vdash e_1:T\to T'$}
\AxiomC{$\Theta;\Gamma\vdash e_2:T$}
\RightLabel{\textsc{$\to$E}}
\BinaryInfC{$\Theta;\Gamma\vdash e_1\ e_2:T'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Theta,\tau;\Gamma\vdash e:T'$} 
\RightLabel{\textsc{$\forall$I}}
\UnaryInfC{$\Theta;\Gamma\vdash\Lambda\tau.\ e:\forall\tau.\ T'$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$\Theta;\Gamma\vdash e:\forall\tau.\ T'$}
\AxiomC{$\Theta\vdash T\text{ type}$}
\RightLabel{\textsc{$\forall$E}}
\BinaryInfC{$\Theta;\Gamma\vdash e\ T:[T/\tau]T'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Theta,\tau\vdash T'\text{ type}$} 
\AxiomC{$\Theta\vdash T\text{ type}$}
\AxiomC{$\Theta;\Gamma\vdash e:[T/\tau]T'$} 
\RightLabel{\textsc{$\exists$I}}
\TrinaryInfC{$\Theta;\Gamma\vdash\textsf{pack}_{\tau.T'}(T,e):\exists\tau.\ T'$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$\Theta;\Gamma\vdash e:\exists\tau.\ T$} 
\AxiomC{$\Theta,\tau;\Gamma,x:T\vdash e':T'$}
\AxiomC{$\Theta\vdash T'\text{ type}$} 
\RightLabel{\textsc{$\exists$E}}
\TrinaryInfC{$\Theta;\Gamma\vdash\textsf{let pack}(\tau,x)=e\textsf{ in }e':T'$}
\DisplayProof

\subsection*{Operational semantics}

(\textsc{Cong}: congruence rule, \textsc{Eval}: evaluation rule)
\medbreak
\noindent
\AxiomC{$e_1\leadsto e_1'$}
\RightLabel{\textsc{CongFun}}
\UnaryInfC{$e_1\ e_2\leadsto e_1'\ e_2$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{$e_2\leadsto e_2'$}
\RightLabel{\textsc{CongFunArg}}
\UnaryInfC{$v\ e_2\leadsto v\ e_2'$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{FunEval}}
\UnaryInfC{$(\lambda x:T.\ e)\ v\leadsto[v/x]e$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e\leadsto e'$}
\RightLabel{\textsc{CongForall}}
\UnaryInfC{$e\ T\leadsto e'\ T$}
\DisplayProof$\qquad$ %=========================================================
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{ForallEval}}
\UnaryInfC{$(\Lambda\tau.\ e)\ T\leadsto[T/\tau]e$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e\leadsto e'$}
\RightLabel{\textsc{CongExists}}
\UnaryInfC{$\textsf{pack}_{\tau.T'}(T,e)\leadsto\textsf{pack}_{\tau.T'}(T,e')$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{$e_1\leadsto e_1'$}
\RightLabel{\textsc{CongExistsUnpack}}
\UnaryInfC{$\textsf{let pack}(\tau,x)=e_1\textsf{ in }e_2\leadsto\textsf{let pack}(\tau,x)=e_1'\textsf{ in }e_2$}
\DisplayProof\bigbreak %========================================================
\noindent
\AxiomC{{\color{white} $[]$}} %placeholder
\RightLabel{\textsc{ExistsEval}}
\UnaryInfC{$\textsf{let pack}(\tau,x)=\textsf{pack}_{\tau.T'}(T,v)\textsf{ in }e\leadsto [T/\tau,v/x]e$}
\DisplayProof

\subsection*{Church encodings}

\subsubsection*{Pairs}

\hspace{-1em}
\begin{tabular}{lcl}
$T_1\times T_2$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\forall\tau.\ (T_1\to T_2\to\tau)\to\tau$\\[0.5em]
$\langle e_1,e_2\rangle$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda k:T_1\to T_2\to\tau.\ k\ e\ e'$\\[0.5em]
\textsf{fst }$e$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$e\ T_1\ (\lambda x:T_1.\ \lambda y:T_2.\ x)$\\[0.5em]
\textsf{snd }$e$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$e\ T_2\ (\lambda x:T_1.\ \lambda y:T_2.\ y)$
\end{tabular}

\subsubsection*{Sums}

\hspace{-1em}
\begin{tabular}{lcl}
$T_1+T_2$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\forall\tau.\ (T_1\to\tau)\to(T_2\to\tau)\to\tau$\\[0.5em]
\textsf{L }$e$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda f:T_1\to\tau.\ \lambda g:T_2\to\tau.\ f\ e$\\[0.5em]
\textsf{R }$e$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda f:T_1\to\tau.\ \lambda g:T_2\to\tau.\ g\ e$\\[0.5em]
\end{tabular}\\
$\textsf{case}(e,\textsf{L }x\to e_1,\textsf{R }y\to e_2):T\ \triangleq\ e\ T\ (\lambda x:T_1\to T.\ e_1)\ (\lambda y:T_2\to T.\ e_2)$

\subsubsection*{Existential types}

$\exists\tau.\ T'\ \triangleq\ \forall\pi.\ (\forall\tau.\ T'\to\pi)\to\pi$\medbreak
\noindent
$\textsf{pack}_{\tau.T'}(T,e)\ \triangleq\ \Lambda\pi.\ \lambda k:\forall\tau.\ T'\to\pi.\ k\ T\ e$\medbreak
\noindent
$\textsf{let pack}(\tau,x)=e\textsf{ in }e':T'\ \triangleq\ e\ T'\ (\Lambda\tau.\ \lambda x:T.\ e')$

\subsubsection*{Booleans}

\hspace{-1em}
\begin{tabular}{lcl}
\textsf{bool} & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\forall\tau.\ \tau\to\tau\to\tau$\\[0.5em]
\textsf{True} & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda x:\tau.\ \lambda y:\tau.\ x$\\[0.5em]
\textsf{False} & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda x:\tau.\ \lambda y:\tau.\ y$\\[0.5em]
\end{tabular}\\
\textsf{if }$e$\textsf{ then }$e_1$\textsf{ else }$e_2:T\ \triangleq\ e\ T\ e_1\ e_2$

\subsubsection*{Natural numbers}

\hspace{-1em}
\begin{tabular}{lcl}
$\mathbb{N}$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\forall\tau.\ \tau\to(\tau\to\tau)\to\tau$\\[0.5em]
\textsf{zero} & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda z:\tau.\ \lambda s:\tau\to\tau.\ z$\\[0.5em]
\textsf{succ}$(e)$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda z:\tau.\ \lambda s:\tau\to\tau.\ s\ (e\ \tau\ z\ s)$\\[0.5em]
\end{tabular}\\
$\textsf{iter}(e,\textsf{zero}\to e_\textsf{z},\textsf{succ}(x)\to e_\textsf{s}):T\ \triangleq\ e\ T\ e_\textsf{z}\ (\lambda x:T.\ e_\textsf{s})$

\subsubsection*{Lists}

\hspace{-1em}
\begin{tabular}{lcl}
\textsf{list }$T$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\forall\tau.\ \tau\to(T\to\tau\to\tau)\to\tau$\\[0.5em]
$[]$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda n:\tau.\ \lambda c:T\to\tau\to\tau.\ n$\\[0.5em]
$e::e'$ & \hspace{-0.5em}$\triangleq$ & \hspace{-0.5em}$\Lambda\tau.\ \lambda n:\tau.\ \lambda c:T\to\tau\to\tau.\ c\ e\ (e'\ \tau\ n\ c)$\\[0.5em]
\end{tabular}\\
$\textsf{fold}(e,[]\to e_\textsf{n},x::r\to e_\textsf{c}):T'\ \triangleq\ e\ T'\ e_\textsf{n}\ (\lambda x:T.\ \lambda r:T'.\ e_\textsf{c})$

\end{document}
